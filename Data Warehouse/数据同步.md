From 《阿里巴巴大数据之路》

数据采集可以分为数据采集（网站埋点等）和数据库数据同步（不同系统的数据流转）。

对于大数据系统来说，包含数据从业务系统同步进入数据仓库和数据从数据仓库同步进入数据服务或数据应用两个方面。

源业务系统的数据类型多种多样，有来源于关系型数据库的结构化数据，如MySQL、 Oracle、 DB2, SQL Server 等；
也有来源于非关系型数据库的非结构化数据，如OceanBase、 HBase、 Mongo DB 等，这类数据通常存储在数据库表中；
还有来源于文件系统的结构化或非结构化数据，如阿里云对象存储 oss、文件存储NAS 等，这类数据通常以文件形式进行存储。

数据同步需要针对不同的数据类型及业务场景选择不同的同步方式。总的来说，同步方式可以分为三种： 直连同步、数据文件同步和数据库日志解析同步。

# 直连同步

***定义：***

直连同步是指通过定义好的规范接口 API 和基于动态链接库的方式直接连接业务库，如ODBC/JDBC 等规定了统一规范的标准接口，不同的数据库基于这套标准接口提供规范的驱动，支持完全相同的函数调用和 SQL实现

***优点：***
这种方式配置简单，实现容易，比较适合操作型业务系统的数据同步。

***缺点：***
但是业务库直连的方式对源系统的性能影响较大，当执行大批量数据同步时会降低甚至拖垮业务系统的性能。

# 数据文件同步

***实现：***
数据文件同步通过约定好的文件编码、大小、格式等，直接从源系统生成数据的文本文件，由专门的文件服务器，如 FTP 服务器传输到目标系统后，加载到目标数据库系统中。

***优点：***
当数据源包含多个异构的数据，库系统（如MySQL、 Oracle、 SQL Server、 DB2 等）时，用这种方式比
较简单、实用。另外，互联网的日志类数据，通常是以文本文件形式存在的，也适合使用数据文件同步方式。

***效率与安全：***
由于通过文件服务器上传、下载可能会造成丢包或错误，为了确保数据文件同步的完整性，通常除了上传数据文件本身以外，还会上传一个校验文件，该校验文件记录了数据文件的数据量以及文件大小等校验信息，以供下游目标系统验证数据同步的准确性。

另外，在从源系统生成数据文件的过程中，可以增加压缩和加密功能，传输到目标系统以后，再对数据进行解压缩和解密， 这样可以大大提高文件的传输效率和安全性。


# 数据库日志解析同步

***实现：***

使用日志文件进行系统恢复，因为日志文件信息足够丰富，而且数据格式也很稳定，完全可以通过解析日志文件获取发生变更的数据，从而满足增量数据同步的需求。

***优点：***
数据库日志解析同步方式实现了实时与准实时同步的能力，延迟可以控制在毫秒级别，并且对业务系统的性能影响也比较小，目前广泛应用于从业务系统到数据仓库系统的增量数据同步应用之中。

通过数据库日志解析进行同步的方式性能好、效率高，对业务系统的影响较小。

***缺点：***
* 数据延迟。例如，业务系统做批量补录可能会使数据更新量超出系统处理峰值，导致数据延迟。
* 投人较大。采用数据库日志抽取的方式投入较大，需要在源数据库与目标数据库之间部署一个系统实时抽取数据。
* 数据漂移和遗漏。数据漂移， 一般是对增量表而言的，通常是指该表的同一个业务日期数据中包含前一天或后一天凌晨附近的数据或者丢失当天的变更数据。这个问题我们将在“数据漂移的处理”一节中详细论述。

# 数据同步步骤

数据仓库的数据类型必须实现格式统一
* 数据同步的方法通常是先创建目标表，再通过同步工具的填写数据库连接、表、 宇段等各种配置信息后测试完成数据同步。
* 数据量较大时，选择每次只同步新变更的增量数据，然后与上一个同步周期获得的全量数据进行合井，从而获得最新版本的全量数据。
